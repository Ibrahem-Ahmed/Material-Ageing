*&---------------------------------------------------------------------*
*&  Include           ZMM_MAGE_TOP
*&---------------------------------------------------------------------*

 DATA PERCE TYPE P LENGTH 16 DECIMALS 8.
  DATA COUNT TYPE N LENGTH 5.
  DATA MSG TYPE CHAR50.

  DATA: gr_alv TYPE REF TO cl_salv_table,
        gr_columns TYPE REF TO cl_salv_columns_table,
        gr_functions TYPE REF TO cl_salv_functions_list,
        gr_sorts      TYPE REF TO cl_salv_sorts,
        gr_column TYPE REF TO cl_salv_column_table,
        gr_layout TYPE REF TO CL_SALV_LAYOUT,
        gs_key    type salv_s_layout_key,
        restrict  type salv_de_layout_restriction,
        not_found TYPE REF TO cx_salv_not_found.
        DATA: colorq TYPE lvc_s_colo.
        DATA: colorv TYPE lvc_s_colo.
DATA DUMMY TYPE CHAR50.

  types : begin of ty_list,
                 text(1024) type c,
                end of ty_list.

  DATA : IS_RSPAR type RSPARAMS,
       IT_RSPAR type table of RSPARAMS.
  RANGES R_DAT FOR SY-DATUM.

  "main table structure
TYPES : BEGIN OF OUT,
    MATNR TYPE MATNR,
    MAKTX TYPE MAKTX,
    WERKS TYPE WERKS_D,
    MTART TYPE MTART,
    MTBEZ TYPE MTBEZ,
    WRKST TYPE MARA-WRKST,

    LBKUM TYPE LBKUM, "STOCK
    SALK3 TYPE SALK3, "VALUE

    LBKUM_30 TYPE LBKUM, "00 TO 30 QUANTITY
    SALK3_30 TYPE SALK3, "00 TO 30 VALUE

    LBKUM_60 TYPE LBKUM, "31 TO 60 QUANTITY
    SALK3_60 TYPE SALK3, "31 TO 60 VALUE

    LBKUM_90 TYPE LBKUM, "61 TO 90 QUANTITY
    SALK3_90 TYPE SALK3, "61 TO 90 VALUE

    LBKUM_120 TYPE LBKUM, "91 TO 120 QUANTITY
    SALK3_120 TYPE SALK3, "91 TO 120 VALUE

    LBKUM_150 TYPE LBKUM, "121 TO 150 QUANTITY
    SALK3_150 TYPE SALK3, "121 TO 150 VALUE

    LBKUM_180 TYPE LBKUM, "151 TO 180 QUANTITY
    SALK3_180 TYPE SALK3, "151 TO 180 VALUE

    LBKUM_360 TYPE LBKUM, "181 TO 360 QUANTITY
    SALK3_360 TYPE SALK3, "181 TO 360 VALUE

    LBKUM_1Y6M TYPE LBKUM, "1Y TO 1Y6M QUANTITY
    SALK3_1Y6M TYPE SALK3, "1Y TO 1Y6M VALUE

    LBKUM_2Y TYPE LBKUM, "1Y6M TO 2Y QUANTITY
    SALK3_2Y TYPE SALK3, "1Y6M TO 2Y VALUE

    LBKUM_2Y6M TYPE LBKUM, "2Y TO 2Y6M QUANTITY
    SALK3_2Y6M TYPE SALK3, "2Y TO 2Y6M VALUE

    LBKUM_999 TYPE LBKUM, "2Y6M TO 999 QUANTITY
    SALK3_999 TYPE SALK3, "2Y6M TO 999 VALUE

  END OF OUT.

  DATA IT_OUT TYPE TABLE OF OUT.
  DATA WA_OUT TYPE OUT.
  FIELD-SYMBOLS <OUT> TYPE OUT.


TYPES : BEGIN OF PERIODS,
    MATNR TYPE MATNR,
    WERKS TYPE WERKS_D,

    LBKUM TYPE CHAR50, "STOCK
    SALK3 TYPE CHAR50, "VALUE
  END OF PERIODS.

  DATA IT_0030    TYPE TABLE OF PERIODS.
  DATA WA_0030    TYPE PERIODS.
  DATA IT_3160    TYPE TABLE OF PERIODS.
  DATA WA_3160    TYPE PERIODS.
  DATA IT_6190    TYPE TABLE OF PERIODS.
  DATA WA_6190    TYPE PERIODS.
  DATA IT_91120   TYPE TABLE OF PERIODS.
  DATA WA_91120   TYPE PERIODS.
  DATA IT_121150  TYPE TABLE OF PERIODS.
  DATA WA_121150  TYPE PERIODS.
  DATA IT_151180  TYPE TABLE OF PERIODS.
  DATA WA_151180  TYPE PERIODS.
  DATA IT_181360  TYPE TABLE OF PERIODS.
  DATA WA_181360  TYPE PERIODS.
  DATA IT_1Y_1Y6M TYPE TABLE OF PERIODS.
  DATA WA_1Y_1Y6M TYPE PERIODS.
  DATA IT_1Y6M_2Y TYPE TABLE OF PERIODS.
  DATA WA_1Y6M_2Y TYPE PERIODS.
  DATA IT_2Y_2Y6M TYPE TABLE OF PERIODS.
  DATA WA_2Y_2Y6M TYPE PERIODS.

TYPES : BEGIN OF TMP_PERIODS,
    MATNR TYPE MATNR,
    WERKS TYPE WERKS_D,

    CLBKUM TYPE CHAR50, "CLOSING STOCK
    INLBKUM TYPE CHAR50, "STOCK-IN
    CSALK3 TYPE CHAR50, "CLOSING VALUE
    INSALK3 TYPE CHAR50, "VALUE-IN
  END OF TMP_PERIODS.


  DATA IT_TMP TYPE TABLE OF TMP_PERIODS.
  DATA WA_TMP TYPE TMP_PERIODS.

*
  DATA: TMP_30    TYPE LBKUM,
        TMP_60    TYPE LBKUM,
        TMP_90    TYPE LBKUM,
        TMP_120   TYPE LBKUM,
        TMP_150   TYPE LBKUM,
        TMP_180   TYPE LBKUM,
        TMP_360   TYPE LBKUM,
        TMP_1Y6M  TYPE LBKUM,
        TMP_2Y    TYPE LBKUM,
        TMP_2Y6M  TYPE LBKUM,
        TMP_999   TYPE LBKUM.

  DATA: TMP_30V   TYPE LBKUM,
        TMP_60V   TYPE LBKUM,
        TMP_90V   TYPE LBKUM,
        TMP_120V  TYPE LBKUM,
        TMP_150V  TYPE LBKUM,
        TMP_180V  TYPE LBKUM,
        TMP_360V  TYPE LBKUM,
        TMP_1Y6MV TYPE LBKUM,
        TMP_2YV   TYPE LBKUM,
        TMP_2Y6MV TYPE LBKUM,
        TMP_999V  TYPE LBKUM.

  DATA: IT_LIST type standard table of ABAPLIST,
        IT_LIST1 type standard table of ty_list,
        WA_LIST1 type  ty_list.

  DATA : XD TYPE DATUM,
         XD1 TYPE DATUM,
         XD2 TYPE DATUM,
         XD3 TYPE DATUM,
         XD4 TYPE DATUM,
         XD5 TYPE DATUM,
         XD6 TYPE DATUM,
         XD7 TYPE DATUM,
         XD8 TYPE DATUM,
         XD9 TYPE DATUM.

TYPES: begin of ctrl,
   RSPAR TYPE CHAR20,

   end of ctrl.

Data: wa_ctrl type ctrl,
      it_ctrl type table of ctrl.

TYPES: BEGIN OF MTATR,
    MATNR TYPE MATNR,
    MTART TYPE MARA-MTART,
    MTBEZ TYPE T134T-MTBEZ,
    WRKST TYPE MARA-WRKST,
  END OF MTATR.

  DATA: IT_MTART TYPE TABLE OF MTATR,
        WA_MTART TYPE MTATR.

TYPES: BEGIN OF TMBEW,
    MATNR TYPE MATNR,
    BWKEY TYPE MBEW-BWKEY,
    VPRSV TYPE MBEW-VPRSV,
    VERPR TYPE MBEW-VERPR,
    STPRS TYPE MBEW-STPRS,
  END OF TMBEW.

  DATA: IT_MBEW TYPE SORTED TABLE OF TMBEW WITH UNIQUE KEY MATNR BWKEY,
        WA_MBEW TYPE TMBEW.

  SELECTION-SCREEN BEGIN OF BLOCK SEL WITH FRAME TITLE TEXT-100.
  SELECT-OPTIONS :
  "select options
    S_MATNR FOR MARC-MATNR,
    S_WERKS FOR MARC-WERKS,
    S_MTART FOR MARA-MTART.
    PARAMETERS P_DATE TYPE DATUM DEFAULT SY-DATUM.
    PARAMETERS P_EXTEND AS CHECKBOX.
    PARAMETERS P_CVALUE AS CHECKBOX.

  SELECTION-SCREEN END OF BLOCK SEL.

  SELECTION-SCREEN BEGIN OF BLOCK SEL2 WITH FRAME TITLE TEXT-200.
  SELECT-OPTIONS :
  "select options
    S_BWART FOR MSEG-BWART.

  SELECTION-SCREEN END OF BLOCK SEL2.
